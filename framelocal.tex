\pgfkeys{
/framelocal/.is family, /framelocal,
default/.style={
startx = 0cm,
starty = 0cm,
dx = 3cm,
dy = 3cm,
start dof offset x = 0cm,
start dof offset y = 0cm,
end dof offset x = 0cm,
end dof offset y = 0cm,
dof size ix = 1cm,
dof size iy = 1cm,
dof size iz = 1cm,
dof size jx = 1cm,
dof size jy = 1cm,
dof size jz = 1cm,
i dofs rotation=0,
j dofs rotation=0,
i rotation dof start angle=110,
i rotation dof end angle=260,
j rotation dof start angle=110,
j rotation dof end angle=260,
i dof nodal offset x = 0.1cm,
i dof nodal offset y = 0.1cm,
i rot nodal offset x = 0.1cm,
i rot nodal offset y = 0.1cm,
j dof nodal offset x = 0.1cm,
j dof nodal offset y = 0.1cm,
j rot nodal offset x = 0.1cm,
j rot nodal offset y = 0.1cm,
i node x dof text=$1'$,
i node y dof text=$2'$,
i node r dof text=$3'$,
j node x dof text=$4'$,
j node y dof text=$5'$,
j node r dof text=$6'$,
i node x dof text rotation=0,
i node y dof text rotation=0,
i node r dof text rotation=0,
j node x dof text rotation=0,
j node y dof text rotation=0,
j node r dof text rotation=0,
i node dof text rotation=0,
j node dof text rotation=0,
global X axis start=0.2cm,
global X axis end=3cm,
global Y axis start=0.4cm,
global Y axis end=4cm,
local x axis start offset=1cm,
local x axis shift=0,
local x axis length=1cm,
local y axis start offset=1.5cm,
local y axis shift=0,
local y axis length=1cm,
global axes font size=\normalsize,
local axes font size=\normalsize,
dof font size = \normalsize,
dof font scale = 1,
dot radius = 2pt,
line thickness = 1.5pt,
show deep beam=1,
beam depth = 6pt,
beam opacity=1,
dashed opacity=1,
gray level=1,
dashed thickness=1pt,
joint i text inner sep = 2pt,
joint j text inner sep = 2pt,
joint text font size = \small,
start joint angle = 0,
end joint angle = 0,
length dimension offset= 0.5cm,
length dimension space ratio = 0.75,
length dimension text rotation=0,
length dimension line thickness=0.5pt,
length dimension extension thickness=0.15pt,
length label text inner sep = 2pt,
length text = {$L$},
properties location = below,
properties rotation = 0,
properties text = {$L,A,E,I$},
length property font size = \normalsize,
rotation text startx = 1.5cm,
rotation text = {$\theta$},
rotation arrow ratio = 1,
place the length dimension = 1,
place global X axis=1,
place global Y axis=1,
place local x axes=1,
place local y axes=1,
place i dofs x axis=1,
place i dofs y axis=1,
place i dofs z axis=1,
place j dofs x axis=1,
place j dofs y axis=1,
place j dofs z axis=1,
place yz dofs only=0,
place angle = 1,
joint i text = $i$,
joint j text = $j$,
local x axis text = $x$,
local y axis text = $y$,
local x axis text rotation=0,
local y axis text rotation=0,
global x axis text = $X$,
global y axis text = $Y$,
arrow size ratio=1,
arrow tip length=6pt,
arrow tip width=4pt,
dof arrow size ratio=1,
dof arrow tip length=4pt,
dof arrow tip width=2pt,},
startx/.store in =\startx,
starty/.store in =\starty,
dx/.store in =\deltaxdir,
dy/.store in =\deltaydir,
start dof offset x/.store in = \startoffsetx,
start dof offset y/.store in = \startoffsety,
end dof offset x/.store in = \endoffsetx,
end dof offset y/.store in = \endoffsety,
dof size ix/.store in = \lengthdofsix,
dof size iy/.store in = \lengthdofsiy,
dof size iz/.store in = \lengthdofsiz,
dof size jx/.store in = \lengthdofsjx,
dof size jy/.store in = \lengthdofsjy,
dof size jz/.store in = \lengthdofsjz,
i dofs rotation/.store in=\dofsroti,
j dofs rotation/.store in=\dofsrotj,
i rotation dof start angle/.store in = \irotdofstartangle,
i rotation dof end angle/.store in = \irotdofendangle,
j rotation dof start angle/.store in = \jrotdofstartangle,
j rotation dof end angle/.store in = \jrotdofendangle, 
i dof nodal offset x/.store in = \idofnodaloffsetx,
i dof nodal offset y/.store in = \idofnodaloffsety,
i rot nodal offset x/.store in = \irotnodaloffsetx,
i rot nodal offset y/.store in = \irotnodaloffsety,
j dof nodal offset x/.store in = \jdofnodaloffsetx,
j dof nodal offset y/.store in = \jdofnodaloffsety,
j rot nodal offset x/.store in = \jrotnodaloffsetx,
j rot nodal offset y/.store in = \jrotnodaloffsety,
i node x dof text/.store in = \inodexdoftext,
i node y dof text/.store in = \inodeydoftext,
i node r dof text/.store in = \inoderdoftext,
j node x dof text/.store in = \jnodexdoftext,
j node y dof text/.store in = \jnodeydoftext,
j node r dof text/.store in = \jnoderdoftext,
i node x dof text rotation/.store in = \inodexdoftextrot,
i node y dof text rotation/.store in = \inodeydoftextrot,
i node r dof text rotation/.store in = \inoderdoftextrot,
j node x dof text rotation/.store in = \jnodexdoftextrot,
j node y dof text rotation/.store in = \jnodeydoftextrot,
j node r dof text rotation/.store in = \jnoderdoftextrot,
i node dof text rotation/.store in = \inodedoftextrot,
j node dof text rotation/.store in = \jnodedoftextrot,
global X axis start/.store in =\globalXstart,
global X axis end/.store in =\globalXend,
global Y axis start/.store in =\globalYstart,
global Y axis end/.store in =\globalYend,
local x axis start offset/.store in =\localxstartoffset,
local x axis shift/.store in =\localxshift,
local x axis length/.store in =\localxlength,
local y axis start offset/.store in =\localystartoffset,
local y axis shift/.store in =\localyshift,
local y axis length/.store in =\localylength,
global axes font size/.store in = \globalaxesfontsize,
local axes font size/.store in = \localaxesfontsize,
dof font size/.store in = \doffontsize,
dof font scale/.store in = \doffontscale,
line thickness/.store in = \linethickness,
show deep beam/.store in = \showdeep,
beam depth/.store in = \beamdepth,
beam opacity/.store in = \beamopa,
dashed opacity/.store in = \dashedopa,
gray level/.store in = \graylevel,
dashed thickness/.store in = \dashedthk,
dot radius/.store in = \dotradius,
joint i text inner sep/.store in = \jointinnersepi,
joint j text inner sep/.store in = \jointinnersepj,
joint text font size/.store in = \jointtextfontsize,
start joint angle/.store in =\startjointangle,
end joint angle/.store in =\endjointangle,
length dimension offset/.store in = \lengthdimoffset,
length dimension space ratio/.store in = \lengthdimspaceratio,
length dimension text rotation/.store in = \lengthlabelrotation,
length dimension line thickness/.store in = \lengthdimlinethick,
length dimension extension thickness/.store in = \lengthdimextthick,
length label text inner sep/.store in = \lengthlabeltextinnersep,
length text/.store in = \lengthtext,
properties location/.store in = \propertyloc,
properties rotation/.store in =\propertyrotation,
properties text/.store in=\propertiestext,
length property font size/.store in = \lengthpropfontsize,
rotation text startx/.store in= \rotationanglex,
rotation text/.store in = \rotationtext,
rotation arrow ratio/.store in = \rotationarrowratio,
place the length dimension/.store in = \placelengthdim,
place global X axis/.store in = \placeglobalaxesX,
place global Y axis/.store in = \placeglobalaxesY,
place local x axes/.store in = \placelocalxaxes,
place local y axes/.store in = \placelocalyaxes,
place i dofs x axis/.store in =\placeidofx,
place i dofs y axis/.store in =\placeidofy,
place i dofs z axis/.store in =\placeidofz,
place j dofs x axis/.store in =\placejdofx,
place j dofs y axis/.store in =\placejdofy,
place j dofs z axis/.store in =\placejdofz,
place yz dofs only/.store in = \placeyzdofsonly,
place angle/.store in = \placeangle,
joint i text/.store in = \jointitext,
joint j text/.store in = \jointjtext,
local x axis text/.store in = \localxtext,
local y axis text/.store in = \localytext,
local x axis text rotation/.store in = \localxtextang,
local y axis text rotation/.store in = \localytextang,
global x axis text/.store in = \globalxtext,
global y axis text/.store in = \globalytext,
arrow size ratio/.store in = \arrsizrat,
arrow tip length/.store in = \arrlen,
arrow tip width/.store in = \arrwid,
dof arrow size ratio/.store in = \dofarrtipsizrat,
dof arrow tip length/.store in = \dofarrtiplen,
dof arrow tip width/.store in = \dofarrtipwid,}

\newcommand{\framelocal}[1][]{
\pgfkeys{/framelocal, default, #1}

\tikzmath{
real \startx, \starty, \deltaxdir, \deltaydir, \dofnodaloffset;
real \rotationangle, \lengthofelement, \startglobalx, \startglobaly;
real \dotradius, \jointinnersepi, \jointinnersepj;
real \lengthdimoffset, \lengthdimspace, \lengthdimspaceratio;
real \startoffsetx, \startoffsety, \endoffsetx, \endoffsety;
real \localxstartoffset, \localystartoffset, \localxlength, \localylength;
real \startjointangle, \endjointangle;
real \globalXstart, \globalXend, \globalYstart, \globalYend;
real \idofnodaloffsetx, \idofnodaloffsety, \irotnodaloffsetx, \irotnodaloffsety;
real \jdofnodaloffsetx, \jdofnodaloffsety, \jrotnodaloffsetx, \jrotnodaloffsety;
real \rotationanglex;
real \globalaxesfontsize, \globalaxesfontsize;
real \arrsizrat, \arrlen, \arrwid, \dofarrtipsizrat, \dofarrtiplen, \dofarrtipwid;
real \rotationarrowratio;
real \beamdepth, \beamopa, \dashedopa, \graylevel, \dashedthk;
int \showdeep;
int \placelocalxaxes, \placelocalyaxes;
%Conversion all units to the unit pt
\startx = \startx;
\starty = \starty;
\deltaxdir = \deltaxdir;
\deltaydir = \deltaydir;
\dotradius=\dotradius;
\jointinnersepi = \jointinnersepi;
\jointinnersepj = \jointinnersepj;
\lengthdimoffset = \lengthdimoffset;
\localxlength = \localxlength;
\localylength = \localylength;
\localxstartoffset = \localxstartoffset;
\localystartoffset = \localystartoffset;
\idofnodaloffsetx = \idofnodaloffsetx;
\idofnodaloffsety = \idofnodaloffsety;
\irotnodaloffsetx = \irotnodaloffsetx;
\irotnodaloffsety = \irotnodaloffsety;
\jdofnodaloffsetx = \jdofnodaloffsetx;
\jdofnodaloffsety = \jdofnodaloffsety;
\jrotnodaloffsetx = \jrotnodaloffsetx;
\jrotnodaloffsety = \jrotnodaloffsety;
\globalXstart=\globalXstart;
\globalXend=\globalXend;
\globalYstart=\globalYstart;
\globalYend=\globalYend;
\rotationanglex = \rotationanglex;
\arrlen = \arrlen;
\arrwid = \arrwid;
\dofarrtiplen = \dofarrtiplen;
\dofarrtipwid = \dofarrtipwid;
\beamdepth=\beamdepth;
%End conversion, All values are now in pt units
\rotationangle = atan2(\deltaydir, \deltaxdir);
if \rotationangle < 5 then {\placeangle=0;};
\lengthofelement = veclen(\deltaxdir, \deltaydir);
\startoffsetx = \startoffsetx;
\startoffsety = \startoffsety;
\endoffsetx = \endoffsetx;
\endoffsety = \endoffsety;
if equal(\placeyzdofsonly,1) then {
\localxstart = \localxstartoffset + \lengthofelement + \jdofnodaloffsetx;
%\idofnodaloffsety=0;
}
else {\localxstart = \localxstartoffset + \lengthofelement + \lengthdofsjx + \jdofnodaloffsetx;};
if equal(\showdeep,1) then {
\jointinnersepi=\jointinnersepi+\beamdepth/2 + \linethickness;
\jointinnersepj=\jointinnersepj+\beamdepth/2 + \linethickness;
%\startoffsety=\startoffsety+\beamdepth/2 + \linethickness;
%\irotnodaloffsety=\irotnodaloffsety - \beamdepth/2 - \linethickness;
%\jrotnodaloffsety=\jrotnodaloffsety - \beamdepth/2 -\linethickness;
} else {};
\localystart = \localystartoffset;
\lengthdimspace = \lengthdimspaceratio * \lengthdimoffset;
\lengthlabelrotation = \rotationangle + \lengthlabelrotation;
\propertyrotation = \propertyrotation + \rotationangle;
\halfbeamdepth=\beamdepth/2;
\halfbeamtotaldepth=\halfbeamdepth+\linethickness;
}


%Settings for arrows
\tikzset{arrowcoord/.style = {arrows={->[length=\arrlen, width=\arrwid, scale=\arrsizrat, flex=1, bend]}}};
\tikzset{arrowangle/.style = {arrows={->[length=\arrlen, width=\arrwid, scale=\rotationarrowratio, flex=1, bend]}}};

\begin{scope}[x=1pt, y=1pt, xshift=\startx, yshift=\starty, rotate=\rotationangle];% Draw everything in pt units
	

%Draw the frame element

% Using Deep Beam
\ifthenelse{\showdeep=1}{
\draw [line width=\linethickness, double=gray!\graylevel, double distance=\beamdepth, opacity=\beamopa]
(0,0) -- (\lengthofelement,0);

\draw [line width = \dashedthk, dashed, opacity=\dashedopa] (0,0) -- (\lengthofelement,0);

\path [] (0,0)
node[inner sep=\jointinnersepi, outer sep=0, anchor=\rotationangle+\startjointangle]{\jointtextfontsize \jointitext} -- (\lengthofelement,0)
node[inner sep=\jointinnersepj, outer sep=0, anchor=\rotationangle+\endjointangle]{\jointtextfontsize \jointjtext}
node[midway, inner sep=\halfbeamtotaldepth+1pt, \propertyloc, rotate=\propertyrotation]{\lengthpropfontsize \propertiestext};
}{

% Using Line

\path [line width = \linethickness, draw=black, postaction={on each segment={mid arrow=black}}] (0,0)
node[inner sep=\jointinnersepi, outer sep=0, anchor=\rotationangle+\startjointangle]{\jointtextfontsize \jointitext} -- (\lengthofelement,0)
node[inner sep=\jointinnersepj, outer sep=0, anchor=\rotationangle+\endjointangle]{\jointtextfontsize \jointjtext}
node[midway, \propertyloc, rotate=\propertyrotation]{\lengthpropfontsize \propertiestext};
}

%Place the dots at the ends of the frame element
\fill [black](0,0) circle[radius=\dotradius];
\fill [black](\lengthofelement,0) circle[radius=\dotradius];

%Place the local x axes
\ifthenelse{\placelocalxaxes=1}{
\draw [arrowcoord] (\localxstart,\localxshift) --
node[at end, inner sep=1.5pt, outer sep=0, anchor=\rotationangle+180+\localxtextang]
{\localaxesfontsize \localxtext}(\localxlength+\localxstart,\localxshift);
}{}

%Place the local y axes
\ifthenelse{\placelocalyaxes=1}{
\draw [arrowcoord] (\localyshift,\localystart) --
node[at end, inner sep=1.5pt, outer sep=0, anchor=\rotationangle-90+\localytextang]
{\localaxesfontsize \localytext}(\localyshift, \localystart+\localylength);
}{}

%Place DOFs at ith joint
\dofs[startx = \startoffsetx, starty = \startoffsety,
length x = \lengthdofsix,length y = \lengthdofsiy,
offset x= \idofnodaloffsetx, offset y= \idofnodaloffsety,
offset rotation xdir = \irotnodaloffsetx, offset rotation ydir = \irotnodaloffsety,
start angle = \irotdofstartangle, end angle = \irotdofendangle, 
radius = \lengthdofsiz, xstring = \inodexdoftext, ystring = \inodeydoftext,
rstring = \inoderdoftext, font size = \doffontsize, font scale=\doffontscale,
rotation=\dofsroti, font rotation=\rotationangle+\inodedoftextrot,
font rotation for x = \inodexdoftextrot+\rotationangle,
font rotation for y = \inodeydoftextrot+\rotationangle,
font rotation for r = \inoderdoftextrot+\rotationangle,
dof arrow size ratio=\dofarrtipsizrat, dof arrow tip length=\dofarrtiplen,
dof arrow tip width=\dofarrtipwid,
show dofx=\placeidofx, show dofy=\placeidofy, show dofr=\placeidofz,];

%Place DOFs at jth joint
\dofs[startx = \lengthofelement+\endoffsetx, starty = \endoffsety,
length x = \lengthdofsjx,length y = \lengthdofsjy,
offset x= \jdofnodaloffsetx, offset y= \jdofnodaloffsety,
offset rotation xdir = \jrotnodaloffsetx, offset rotation ydir = \jrotnodaloffsety,
start angle = \jrotdofstartangle, end angle = \jrotdofendangle, 
radius = \lengthdofsjz, xstring = \jnodexdoftext, ystring = \jnodeydoftext,
rstring = \jnoderdoftext, font size = \doffontsize, font scale=\doffontscale,
rotation=\dofsrotj, font rotation=\rotationangle+\jnodedoftextrot,
font rotation for x = \jnodexdoftextrot+\rotationangle,
font rotation for y = \jnodeydoftextrot+\rotationangle,
font rotation for r = \jnoderdoftextrot+\rotationangle,
dof arrow size ratio=\dofarrtipsizrat, dof arrow tip length=\dofarrtiplen,
dof arrow tip width=\dofarrtipwid,
show dofx=\placejdofx, show dofy=\placejdofy, show dofr=\placejdofz,];

%Place the length dimension line
\ifthenelse{\placelengthdim=1}{
\dimline[line style={line width = \lengthdimlinethick},
extension start length={\lengthdimspace pt}, extension start style={black, line width=0.15pt},
extension end length={\lengthdimspace pt}, extension end style={black, line width=0.15pt}]
{(0 , \lengthdimoffset)}{(\lengthofelement , \lengthdimoffset)}{\lengthpropfontsize \lengthtext}{\lengthlabelrotation}{\lengthlabeltextinnersep};
}{}

%\path [line width = \linethickness, draw=black, postaction={on each segment={mid arrow=black}}]
%(0,0)node[left=-0.05cm]{\small $i$} -- (\deltaxdir,\deltaxdir)node[right=-0.1cm]{\small $j$};
%\draw [->] (\lengthdofs,0) -- node[at end, above]{$X$}++(\deltaxdir,0);
%\draw [->] (0,\lengthdofs) -- node[at end, right]{$Y$}++(0,\deltaxdir);
%\draw [->] (\localxstart,\localxy) -- node[at end, above]{$x$}++(\localxdx,\localxdy);
%\draw [->] (\localyangl:\localystart)-- node[at end, right]{$y$}++(\localyangl:\localyleng);
%\draw [arrows={->[]}](\rotationanglex,0) arc [start angle=0, end angle=\rotationangle, radius=\rotationanglex] node[midway, right=-0.05cm]{$\theta$};
%\fill [black](0,0) circle[radius=\dotrad];
%\fill [black](\deltaxdir,\deltaxdir) circle[radius=\dotrad];
%

\end{scope}


%Place the global axes
\ifthenelse{\placeglobalaxesX=1}{
\begin{scope}[x=1pt, y=1pt, xshift=\startx, yshift=\starty, rotate=0]; 
\draw [arrowcoord] (\globalXstart,0) -- node[at end, inner sep=1pt, outer sep = 0, right]{\globalaxesfontsize \globalxtext}(\globalXend,0);
\end{scope}
}{}

%Place the global axes
\ifthenelse{\placeglobalaxesY=1}{
\begin{scope}[x=1pt, y=1pt, xshift=\startx, yshift=\starty, rotate=0]; 
\draw [arrowcoord] (0,\globalYstart) --
node[at end, inner sep=1pt, outer sep = 0, above]{\globalaxesfontsize \globalytext}
(0,\globalYend);
\end{scope}
}{}

%Place the angle
\ifthenelse{\placeangle=1}{
\begin{scope}[x=1pt, y=1pt, xshift=\startx, yshift=\starty, rotate=0];
\draw [arrowangle](\rotationanglex,0)
arc [start angle=0, end angle=\rotationangle, radius=\rotationanglex]
node[midway,inner sep=1pt, outer sep = 0, anchor=180+\rotationangle/2]{\globalaxesfontsize \rotationtext};
\end{scope}
}{}
}